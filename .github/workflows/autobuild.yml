name: Autobuild
on: 
  push:

jobs:
  aarch64_job:
    runs-on: ubuntu-22.04
    name: Build on ubuntu22.04 aarch64
    steps:
      - name: Check-out repository
        uses: actions/checkout@v4
      - name: Set up QEMU
        if: runner.os == 'Linux'
        uses: docker/setup-qemu-action@v3
        with:
          image: tonistiigi/binfmt:master
          platforms: arm64
      - uses: uraimo/run-on-arch-action@v2
        name: Run on aarch64
        id: runcmd
        with:
          arch: aarch64
          distro: ubuntu22.04
          githubToken: ${{ github.token }}
          dockerRunArgs: |
            --volume "${PWD}:/myproject"
          shell: /bin/sh
          install: |
            apt-get update -q -y
            apt-get install -q -y git patchelf python3-pip python-is-python3 wget
          run: |
            cd /myproject

            wget https://raw.githubusercontent.com/marcelotduarte/cx_Freeze/refs/heads/main/requirements.txt
            pip install  --upgrade -r requirements.txt

            pip install  --pre --no-cache --upgrade -i https://test.pypi.org/simple/ cx-Freeze==7.3.0.dev1732258507

            export PATH="/usr/local/bin:$PATH"
            python -m cx_Freeze --script main.py --target-name=executable

            ./$(find build -name "executable")
            cat success.txt
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Build
          path: |
            build/exe.*/**